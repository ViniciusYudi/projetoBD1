{% extends "base.html" %}

{% block title %}Relatório da Turma{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    
    <div class="mb-6 flex items-center justify-between">
        <div>
            <a href="{{ url_for('home_professor', professor_id=professor_id) }}" class="text-blue-600 hover:underline mb-2 inline-block">← Voltar para Painel</a>
            <h2 class="text-3xl font-extrabold text-gray-900">{{ turma.nome }}</h2>
            <p class="text-gray-500 text-lg">Semestre: {{ turma.semestre }}</p>
        </div>
    </div>

    <div class="bg-white p-6 rounded-xl shadow-lg mb-8 border border-gray-100">
        <h3 class="text-xl font-bold mb-4 text-gray-800 border-b pb-2">Média das Notas (0 a 5)</h3>
        
        <div class="overflow-x-auto">
            <table class="min-w-full text-left text-sm">
                <thead class="bg-gray-50 text-gray-600 font-medium uppercase tracking-wider">
                    <tr>
                        <th class="px-4 py-3 rounded-tl-lg">Questão</th>
                        <th class="px-4 py-3">Média</th>
                        <th class="px-4 py-3 rounded-tr-lg">Respostas</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-100">
                    {% for item in quantitativo %}
                    <tr class="hover:bg-gray-50 transition">
                        <td class="px-4 py-3 text-gray-700 font-medium">{{ item.enunciado }}</td>
                        <td class="px-4 py-3">
                            <span class="bg-blue-100 text-blue-800 py-1 px-3 rounded-full font-bold text-xs">
                                {{ item.media_nota }}
                            </span>
                        </td>
                        <td class="px-4 py-3 text-gray-500">{{ item.qtd_respostas }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="bg-white p-6 rounded-xl shadow-lg mb-8 border border-gray-100">
        <h3 class="text-xl font-bold mb-4 text-gray-800 border-b pb-2">Histórico: Eu vs. Outros Professores</h3>
        
        <div class="relative h-64 w-full">
            <canvas id="graficoComparativo"></canvas>
        </div>
        
        <p class="text-xs text-gray-400 mt-4 text-center">
            * Compara a média geral desta disciplina ao longo dos semestres.
        </p>
    </div>

    <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
        <h3 class="text-xl font-bold mb-4 text-gray-800 border-b pb-2">O que os alunos disseram</h3>
        
        {% if qualitativo %}
            <div class="grid gap-4">
                {% for item in qualitativo %}
                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                    <p class="text-xs text-gray-500 font-bold uppercase mb-1 tracking-wide">{{ item.enunciado }}</p>
                    <p class="text-gray-700 italic">"{{ item.texto_resposta }}"</p>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center py-8 text-gray-400">
                <p>Nenhum comentário por escrito nesta turma.</p>
            </div>
        {% endif %}
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    const ctx = document.getElementById('graficoComparativo').getContext('2d');
    
    const labels = {{ labels_chart|safe }};
    const dataEu = {{ data_eu_chart|safe }};
    const dataOutros = {{ data_outros_chart|safe }};

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [
                {
                    label: 'Minha Média',
                    data: dataEu,
                    borderColor: '#2563EB',
                    backgroundColor: 'rgba(37, 99, 235, 0.1)',
                    borderWidth: 3,
                    tension: 0.3,
                    pointRadius: 6,
                    pointHoverRadius: 8
                },
                {
                    label: 'Média Colegas',
                    data: dataOutros,
                    borderColor: '#9CA3AF',
                    borderWidth: 2,
                    borderDash: [5, 5],
                    tension: 0.3,
                    pointRadius: 4
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    max: 5,
                    grid: { color: '#f3f4f6' }
                },
                x: {
                    grid: { display: false }
                }
            },
            plugins: {
                legend: { position: 'bottom' }
            }
        }
    });
</script>
{% endblock %}